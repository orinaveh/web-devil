---
import PagesList from "../../components/PagesList.svelte";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const articles = await Astro.glob('../article/*.md')
  const tags = new Map();
  articles.forEach((article) => {
    article.frontmatter.tags.forEach((tag: string) => {
        const currentState = tags?.get(tag);
        tags.set(tag, currentState ? [...currentState, article] : [article])
    })
})
  return Array.from(tags).map(([tag, articlesOfTag]) => ({
    params: { 
      tag: tag 
    },
    props: { articles: articlesOfTag, tag },
  }))
}

const { articles, tag } = Astro.props
---

<Layout title={tag}>
  <PagesList items={articles.map((article: any) => ({
    title: article.frontmatter.title,
    author: article.frontmatter.author,
    url: article.url
  }))}  />
</Layout>